---
title: MySQL概念及操作
date: 2020-09-30 11:25:25
tags: SQL
top: 0
---

# 一、MySQL操作

# 二、SQL特性

### 1  [复制集与分布式](https://handout-1300728887.cos.ap-beijing.myqcloud.com/%E8%AE%B2%E4%B9%89/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E9%A1%B9%E7%9B%AE%E8%AF%BE%E4%BB%B6/C02-Database/DatabaseTheory.html)

- 复制集：
  1. 数据库中数据相同，起到备份作用
  2. 高可用

- 分布式：
  1. 数据库中数据不同，共同组成完整的数据集合
  2. 高吞吐
  
  <!--more-->

### 2  主从复制

1. 主服务器的数据发生改变时，会将改变的记录写在本地二进制log日志中
2. 从服务器的一个线程会把更新的数据拷贝中继log日志中
3. 从服务器读取中继文件并执行，达到主从一致

 **利用主从在达到高可用的同时，也可以通过读写分离提供吞吐量。** 

### 3  [事务](https://handout-1300728887.cos.ap-beijing.myqcloud.com/%E8%AE%B2%E4%B9%89/python-web%E5%9F%BA%E7%A1%80(5.1.2%E7%89%88%E6%9C%AC)/mysqlhigh/%E4%BA%8B%E5%8A%A1.html)

- 四大特性：
  - 原子性：强调事务中的多个操作时一个整体
  - 一致性：强调数据库中不会保存不一致状态
  - 隔离性：强调数据库中事务之间相互不可见
  - 持久性：强调数据库能永久保存数据，一旦提交就不可撤销
- 隔离级别：
  - 读已提交：一个事务要等另一个事务提交后才能读取数据，可避免脏读的发生。
  - 读未提交：一个事务可以读取另一个未提交事务的数据，最低级别，任何情况都无法保证。
  - **可重复读(MySQL默认)**：就是在开始读取数据（事务开启）时，不再允许修改操作，可避免脏读、不可重复读的发生。
  - 串行化：最高的事务隔离级别，事务串行化顺序执行，可以避免脏读、不可重复读与幻读。效率抵消，耗性能

# 二、Mysql优化

### 1  [索引](https://handout-1300728887.cos.ap-beijing.myqcloud.com/%E8%AE%B2%E4%B9%89/python-web%E5%9F%BA%E7%A1%80(5.1.2%E7%89%88%E6%9C%AC)/mysqlhigh/%E7%B4%A2%E5%BC%95.html)

也叫“键”，保存数据库中所有记录的位置信息，相比于目录

优点：加快查询速度

缺点：耗费时间空间（不是越多越好）

**优化**

1. 不是越多越好，而是需要自己合理的使用

### 2  [sql语句优化](https://handout-1300728887.cos.ap-beijing.myqcloud.com/%E8%AE%B2%E4%B9%89/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E9%A1%B9%E7%9B%AE%E8%AF%BE%E4%BB%B6/C02-Database/DatabaseOptimize.html)

- 1.避免全表扫描 
- 2.查询时使⽤select明确指明所要查询的字段，避免使⽤ select * 的操作； 
- 3.SQL语句尽量⼤写 
- 4.尽量避免在 where ⼦句中使⽤!=或<>操作符， 
- 5.遵循最左原则，在where⼦句中写查询条件时把索引字段放在前⾯ 
- 6.能使⽤关联查询解决的，尽量不要使⽤⼦查询 
- 7.能不使⽤关联查询的尽量不要使⽤关联查询 
- 8.不需要获取全表数据的时候，不要查询全表数据，使⽤LIMIT来限制数据 

### 3  数据库的优化

- 在进⾏表设计时，可适度增加冗余字段(反范式设计)，减少JOIN操作；
- 多字段表可以进⾏垂直分表优化，多数据表可以进⾏⽔平分表优化；
- 选择恰当的数据类型，如整型的选择；
- 对于强调快速读取的操作，可以考虑使⽤MyISAM数据库引擎；
- 对较频繁的作为查询条件的字段创建索引；唯⼀性太差的字段不适合单独创建索引，即使频繁作为查询条件；更新⾮常频繁的字段不适合创建索引；
- 编写SQL时使⽤上⾯的⽅式对SQL语句进⾏优化；
- 使⽤慢查询⼯具找出效率低下的SQL语句进⾏优化；
- 构建缓存，减少数据库磁盘操作；
- 可以考虑结合使⽤内存型数据库，如Redis，进⾏混合存储。

### 4  数据库存储过程与触发器

存储过程：完成特定功能的SOL语句集

触发器：对表进行（插入、删除、更新）触发一系列预定好的SQL语句

### 5  [数据库设计](https://handout-1300728887.cos.ap-beijing.myqcloud.com/%E8%AE%B2%E4%B9%89/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E9%A1%B9%E7%9B%AE%E8%AF%BE%E4%BB%B6/C02-Database/DatabaseDesign.html)

库设计：

1. 数据库名要明确
2. 不同类型的数据分开管理

表设计：

1. 命名，业务表跟基础表区分，驼峰命名法
2. 词性分析法，**名词体现表或字段，动词体现关系**
   - 一对一、一对多、多对多
3. 不要用物理删除，以防后悔
4. 三范式：
   - 字段不可分割、原子性
   - 满足范式一，表有主键依赖
   - 满足范式二，表非主字段之间没有依赖关系。
5. 反范式：**利用冗余字段存储数据，节省数据查询的时间，本质是空间换时间。**
6. 字段类型、是否允许为null、是否有默认值
   - 整形：int长度并不影响精度，长度只和显示有关
     - **存储范围相同**
   - 字符串：char和varchar
     - char不可变，查询效率高，可能造成存储浪费
     - varchar可变，查询效率不如char，节省空间
7. 索引设计
   - 主键、外键、唯一约束；
   - key/value，提高查询效率的字段；
   - **外键：作用是维护数据的完整性。**
     - 应用：在实际开发项目过程中，用不用外键？
     - 建议：项目开发初期可以利用外键帮助维护数据的完整性，但是，项目的中后期，建议移除外键。
8. 数据库引擎（MySQL的核心）的选择：决定数据存储和增删改查方式，争对表
   - **InnoDB**（事务、安全能力）
     1. **支持事务，安全性级别较高，查询效率相对较低。**
     2. 为处理巨大数据量的最大性能设计
     3. **InnoDB支持外键完整性约束**
   - **MyISAM**（主要用来插入和查询）
     1. **不支持事务，插入、查询效率较高，增删改效率较低。**
     2. 产生三个文件（名字一表名字开始）：
        1. frm：文件存储表定义
        2. .MYD：数据文件
        3. .MYI：索引文件
   - **MEMORY**（存放临时数据）
     1. 将表中数据存储到内存中，未查询和引用其他表数据提供快速访问

#### 5.1  分库分表

**垂直拆分**

- 垂直分表："大表拆小表"，基于列字段进行，将不常用，数据较大，长度较长拆分
- 垂直分库：根据业务切分成不同的库

**水平拆分**

- 水平分表：针对数据量巨大的单张表， 按照某种规则（RANGE,HASH取模等），切分到多张表里面去,有IO瓶颈
- 水平分库分表：将表数据切分到多个服务器上，分布式，有效解决瓶颈、突破IO

**先垂直分在水平分**

##### 分库分表后面临的问题

- 事务支持
- 多库结果集合并
- 跨库join

**分库分表方案产品中间件**：官方MySQL Fabric、阿里TDDL，Cobar、360Atlas

### 6  where和having哪个执行更快

SQL语句执行顺序：

`from -> where -> group by -> having -> select -> order by`

两者区别：

where：是一个约束声明，结果返回之前起作用，不能使用聚合函数

having：是一个过滤声明，过滤分组数据，只能用于group by，可以使用聚合函数